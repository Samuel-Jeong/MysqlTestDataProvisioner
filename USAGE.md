# 사용 가이드

## 빠른 시작

### 1. 의존성 설치

```bash
pip install -r requirements.txt
```

### 2. 프로그램 실행

```bash
python mysql-test-data-provisioner.py
```

## 단계별 사용법

### Step 1: 프로파일 선택

1. 프로그램 실행 후 키보드에서 **1** 입력
2. 사용 가능한 프로파일 목록이 표시됩니다
   ```
   1. wpm
   2. example
   ```
3. 원하는 프로파일 번호 입력 후 Enter
4. 선택된 프로파일의 DB 연결 정보가 자동으로 로드됩니다

### Step 2: 시나리오 선택

1. 키보드에서 **2** 입력
2. 선택한 프로파일의 시나리오 목록이 표시됩니다
   ```
   1. small-test.json
   2. large-test.json
   ```
3. 원하는 시나리오 번호 입력 후 Enter

### Step 3: 스키마 및 시나리오 분석

1. 키보드에서 **3** 입력
2. 프로그램이 자동으로:
   - schema.sql 파일을 파싱하여 테이블 구조 분석
   - 시나리오 파일을 로드하여 연관관계 분석
3. 분석 결과가 화면에 표시됩니다
   ```
   분석 완료: 테이블 6개, 시나리오 테이블 6개
   ```

### Step 4: 테스트 데이터 생성

1. 키보드에서 **4** 입력
2. 프로그램이 DB에 연결하여 데이터를 생성합니다
3. 실시간 진행률이 표시됩니다
   ```
   테이블 'customers' 처리 중... (5/5, 100%)
   테이블 'products' 처리 중... (10/15, 66%)
   ```
4. 완료되면 run_id가 표시됩니다
   ```
   데이터 생성 완료! run_id=20231209153045
   ```

### Step 5: 데이터 롤백 (선택사항)

생성한 데이터를 삭제하려면:

1. 키보드에서 **5** 입력
2. 이전 실행 목록이 표시됩니다
   ```
   1. 20231209153045 [example/small-test.json] 2023-12-09T15:30:45
   2. 20231209143022 [wpm/tbl_test-1.json] 2023-12-09T14:30:22
   ```
3. 롤백할 실행 번호 입력 후 Enter
4. 해당 run에서 생성된 데이터만 삭제됩니다
   ```
   run_id=20231209153045 롤백 완료
   ```

### Step 6: MySQL 덤프 (선택사항)

DB를 백업하려면:

1. 키보드에서 **6** 입력
2. 프로그램이 mysqldump를 실행하여 SQL 파일을 생성합니다
   ```
   mysqldump 완료: dump_example_db_20231209153045.sql
   ```

## 화면 구성

```
┌─────────────────────────────────────────────────────────┐
│          MySQL 자동 테스트 데이터 생성기 (TUI)          │  ← 헤더
│  Profile: example | Scenario: small-test.json           │
│  1: 프로파일 선택 | 2: 시나리오 선택 | ... | Q: 종료  │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [ 현재 상태 ]                                           │  ← 중간 영역
│    프로파일: example                                     │     (상태/로그)
│    시나리오: small-test.json                             │
│    스키마 테이블: 6개                                    │
│                                                          │
│  [ 최근 메시지 ]                                         │
│    데이터 생성 완료! run_id=20231209153045              │
│                                                          │
│  [ 로그 ]                                                │
│    [15:30:45] 프로그램 시작                             │
│    [15:30:48] 프로파일 선택: example                    │
│    [15:30:50] 시나리오 선택: small-test.json           │
│    [15:30:52] 스키마 분석 완료: 6개 테이블              │
│    [15:30:55] 데이터 생성 시작                          │
│    [15:31:02] 생성 완료: run_id=20231209153045         │
│                                                          │
├─────────────────────────────────────────────────────────┤
│  [진행] 대기 중...                                       │  ← 하단 영역
│  명령: 1=프로파일 2=시나리오 3=분석 4=생성 5=롤백      │     (상태바)
│        6=덤프 Q=종료                                     │
└─────────────────────────────────────────────────────────┘
```

## 주요 개념

### 프로파일 (Profile)

- 하나의 DB 환경을 나타냅니다
- config/{profile}/ 디렉토리에 저장됩니다
- 포함 파일:
  - `connection.json` - DB 연결 정보
  - `schema.sql` - 테이블 스키마 정의

### 시나리오 (Scenario)

- 테스트 데이터 생성 계획을 나타냅니다
- scenario/{profile}/ 디렉토리에 저장됩니다
- 각 테이블별로 생성할 레코드 수와 연관관계를 정의합니다

### Run ID

- 각 데이터 생성 실행마다 고유한 ID가 부여됩니다
- 형식: YYYYMMDDHHmmss (예: 20231209153045)
- 롤백 시 이 ID를 사용하여 특정 실행의 데이터만 삭제할 수 있습니다
- 실행 로그는 `work/{profile}_{scenario}/run_{id}.json` 형식으로 저장됩니다

### 연관관계 (Relations)

- 시나리오 파일에서 FK 관계를 정의합니다
- 형식: `"자식_컬럼": "부모_테이블.부모_컬럼"`
- 예: `"user_id": "users.id"`
- 부모 테이블에서 자동으로 랜덤 PK를 선택하여 할당합니다

## 실전 예제

### 예제 1: 개발 환경 데이터 생성

```
목표: 개발용 소량 테스트 데이터 생성

1. 프로그램 실행
2. 메뉴 1: "example" 프로파일 선택
3. 메뉴 2: "small-test.json" 선택
4. 메뉴 3: 분석 실행
5. 메뉴 4: 데이터 생성
   → 고객 5명, 제품 10개, 주문 8개 등 생성됨
```

### 예제 2: 성능 테스트 데이터 생성

```
목표: 대량 데이터로 성능 테스트

1. 프로그램 실행
2. 메뉴 1: "example" 프로파일 선택
3. 메뉴 2: "large-test.json" 선택
4. 메뉴 3: 분석 실행
5. 메뉴 4: 데이터 생성
   → 고객 100명, 제품 500개, 주문 300개 등 생성됨
```

### 예제 3: 데이터 초기화

```
목표: 테스트 후 데이터 정리

1. 메뉴 5: 롤백 선택
2. 삭제할 run 선택 (예: 최근 실행)
3. 해당 run에서 생성된 데이터만 삭제됨
   → 다른 데이터는 영향 없음
```

### 예제 4: DB 백업

```
목표: 테스트 데이터가 포함된 DB 백업

1. 데이터 생성 후
2. 메뉴 6: 덤프 선택
3. SQL 파일이 dump/ 디렉토리에 생성됨
   → dump/dump_example_db_20231209153045.sql
```

## 문제 해결

### Q: 프로파일이 목록에 표시되지 않습니다

**A:** config/{profile}/ 디렉토리에 다음 두 파일이 모두 있는지 확인하세요:
- connection.json
- schema.sql

### Q: 데이터 생성 중 오류가 발생합니다

**A:** 다음을 확인하세요:
1. DB 연결 정보가 정확한지 (connection.json)
2. MySQL 서버가 실행 중인지
3. 시나리오의 테이블 순서가 올바른지 (부모 → 자식)
4. 모든 테이블에 AUTO_INCREMENT PK가 있는지

### Q: 롤백이 실패합니다

**A:** 다음을 확인하세요:
1. work/ 디렉토리에 해당 run_id의 JSON 파일이 있는지
2. FK 제약 조건이 설정되어 있는지
3. 스키마 파일이 현재 DB 구조와 일치하는지

### Q: 프로그램이 "이미 실행 중" 메시지를 표시합니다

**A:** 
- 다른 인스턴스를 종료하거나
- 프로젝트 디렉토리의 `.mysql_testdata_generator.lock` 파일을 삭제하세요

## 팁

1. **시나리오 파일 작성 시**
   - 부모 테이블을 자식 테이블보다 먼저 정의하세요
   - relations에 정의된 컬럼은 자동으로 FK 값이 할당됩니다

2. **대량 데이터 생성 시**
   - 처음엔 소량으로 테스트 후 점진적으로 늘리세요
   - 진행률을 확인하며 DB 성능을 모니터링하세요

3. **롤백 사용 시**
   - run_id로 정확한 실행을 선택할 수 있습니다
   - 여러 번 데이터를 생성하고 각각 롤백할 수 있습니다

4. **프로파일 관리**
   - 환경별로 프로파일을 분리하세요 (dev, test, staging)
   - 각 프로파일마다 다른 시나리오를 준비하세요

5. **파일 구조**
   - 실행 로그는 `work/{profile}_{scenario}/` 디렉토리별로 관리됩니다
   - 덤프 파일은 `dump/` 디렉토리에 저장됩니다
   - 프로파일/시나리오별로 분리되어 관리가 용이합니다

## 추가 리소스

- README.md: 전체 개요 및 설치 방법
- config/example/: 예제 프로파일
- scenario/example/: 예제 시나리오

